{% extends 'base.html.twig' %}

{% block title %}Resource {{ id }}{% endblock %}

{% block body %}
<style>
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; padding: 0; background: #0b1020; color: #e6ebff; }
  main { padding: 24px; }
  section { background: #0f1833; border: 1px solid #1a2547; border-radius: 10px; padding: 16px; max-width: 720px; }
  input, textarea, button { background: #0c1430; color: #e6ebff; border: 1px solid #203160; border-radius: 8px; padding: 10px 12px; font-size: 14px; }
  button { cursor: pointer; background: #2a47b8; border-color: #3758d6; }
  button.danger { background: #8a1538; border-color: #b01c47; }
  .row { display:flex; gap:8px; align-items:center; }
  .muted { color:#93a6ff; font-size:12px; }
</style>

<main>
  <a href="/" class="muted">← Назад</a>
  <h2>Ресурс #{{ id }}</h2>
  <section>
    <div id="msg" class="muted"></div>
    <div class="row" style="margin-bottom:8px;">
      <input id="name" placeholder="Name" />
      <input id="status" placeholder="Status" />
    </div>
    <div class="row" style="margin-bottom:8px;">
      <textarea id="description" placeholder="Description" style="width:100%;"></textarea>
    </div>
    <div class="row">
      <button id="saveBtn">Сохранить</button>
      <button id="deleteBtn" class="danger">Удалить</button>
    </div>
  </section>
</main>

<script>
  const id = {{ id }};
  const token = localStorage.getItem('jwt_token');
  const headers = { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` };
  const api = async (path, opts={}) => {
    const res = await fetch(path, { ...opts, headers: { ...headers, ...(opts.headers||{}) } });
    const text = await res.text();
    const data = text ? JSON.parse(text) : {};
    if (!res.ok) throw data;
    return data;
  };

  async function load() {
    try {
      const r = await api(`/api/resources/${id}`);
      document.getElementById('name').value = r.name || '';
      document.getElementById('status').value = r.status || '';
      document.getElementById('description').value = r.description || '';
    } catch (e) {
      document.getElementById('msg').textContent = e?.error || 'Failed to load';
    }
  }
  load();

  document.getElementById('saveBtn').onclick = async () => {
    const body = {
      name: document.getElementById('name').value,
      status: document.getElementById('status').value,
      description: document.getElementById('description').value,
    };
    try { await api(`/api/resources/${id}`, { method: 'PUT', body: JSON.stringify(body) }); location.href = '/'; }
    catch(e){ document.getElementById('msg').textContent = e?.error || (e?.errors||[]).join(', ') || 'Failed to save'; }
  };
  document.getElementById('deleteBtn').onclick = async () => {
    try { await api(`/api/resources/${id}`, { method: 'DELETE' }); location.href = '/'; }
    catch(e){ document.getElementById('msg').textContent = e?.error || 'Failed to delete'; }
  };
</script>
{% endblock %}


